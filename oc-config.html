<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="oc-core.html">

<dom-module id="oc-config">
    <template>
    </template>

    <script>
        class OcConfig extends Polymer.Element {
            static get is() { return 'oc-config'; }

            static get properties() {
                return {
                    /**
                     * Your client id obtained from client registration
                     */
                    clientId: String,
                    /**
                     * The id of the organisation
                     */
                    organisationId: String,
                    /**
                     * Token redirect uri you've registered for this client
                     */
                    tokenRedirectUri: String,
                    /**
                     * Authentication clientId
                     */
                    authClientId: String,
                    /**
                     * Authentication host location
                     */
                    authHostUrl: String,
                    /**
                     * API host location
                     */
                    apiHostUrl: String,

                    /**
                     * Environment development, qa, sandbox, production
                     */
                    environment: String
                }
            }

            static get observers()  {
                return [
                    '_setConfig(clientId, organisationId,  tokenRedirectUri,authClientId, authHostUrl, apiHostUrl, environment)'
                ]}

            ready() {
                super.ready();
            }

            _setConfig(clientId, organisationId , tokenRedirectUri, authClientId, authHostUrl, apiHostUrl, environment) {
                OC.context = {
                    clientId: clientId,
                    organisationId : organisationId,
                    tokenRedirectUri:tokenRedirectUri,
                    authClientId: authClientId,
                    authHostUrl: authHostUrl,
                    apiHostUrl: apiHostUrl
                };

                OC.enviroment = environment;

                /**
                 * Only fire event when all properties are loaded
                 */
                if(clientId && organisationId  && tokenRedirectUri  && authClientId && authHostUrl  && apiHostUrl ){
                    this.dispatchEvent(new CustomEvent('oc-config-complete',
                        {
                            bubbles: true
                            , composed: true}
                        )
                    );
                }

            }

        }
        window.customElements.define(OcConfig.is, OcConfig);
    </script>
</dom-module>